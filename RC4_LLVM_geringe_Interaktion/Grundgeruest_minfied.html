<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<title>Clang-LLVM WebAssembly</title>
	<script type="text/javascript" src="GlueCode.js"></script>
	<script type="text/javascript">
	</script>
		var wasmObj,buffer,key,keylength,plaintext,plaintextlength,ciphertext;init();async function init(){wasmObj=await initializeWebAssembly(),buffer=new Uint32Array(getBuffer())}function readKeyFromGUI(){var a=document.getElementById("key_input").value,b=a.split(/(\s+)/).filter(a=>0<a.trim().length),c=b.map(a=>parseInt(a,10));key=0,keylength=c.length;for(var d=0;d<keylength;d++)buffer[d]=c[d]}function readAndCreatePlaintext(){var a=document.getElementById("plaintext_length_input").value;plaintextlength=parseInt(a);var b=4*keylength+4*(2*plaintextlength),c=buffer.byteLength;if(b>c){var d=Math.ceil((b-c)/65536);growMemory(d),buffer=new Uint32Array(getBuffer())}plaintext=keylength;for(var e=plaintext;e<plaintextlength+plaintext;e++)buffer[e]=255*Math.random()}function encrypt(){ciphertext=plaintext+plaintextlength,wasmObj.instance.exports.rc4(4*key,keylength,4*plaintext,plaintextlength,4*ciphertext)}function printResultToGUI(){for(var a="",b=Math.min(16,plaintextlength),c=ciphertext;c<ciphertext+b;c++)a+=buffer[c].toString(16).toUpperCase()+" ";document.getElementById("output").innerHTML=a}function doIt(){var a=performance.now();readKeyFromGUI();var b=performance.now();readAndCreatePlaintext();var c=performance.now();encrypt();var d=performance.now();printResultToGUI();var e=performance.now();document.getElementById("time12").innerHTML=Math.round(b-a)+" ms",document.getElementById("time23").innerHTML=Math.round(c-b)+" ms",document.getElementById("time34").innerHTML=Math.round(d-c)+" ms",document.getElementById("time45").innerHTML=Math.round(e-d)+" ms"}
	</head>
	<body>
		<h2>RC4 Implementierung mit Clang-LLVM-WebAssembly und geringer GUI-Interaktion</h2><h3>Bedienungsanleitung</h3><p> Auf den grünen Button "Ver-/Entschlüsseln" klicken. Die Standardwerte sind korrekt eingestellt. Die gelb hinterlegten Felder werden mit Ausgaben gefüllt.</p><h3>Parametereingabe</h3><form><p>Schlüssel (1 Byte Hex Werte, Leerzeichen separiert). <span style="color:grey">Intern wird jedes Byte als uint32 verarbeitet. Der Schlüssel benötigt also viermal so viel Speicherplatz wie hier angegeben.</span><br /><textarea id="key_input" rows="3" cols="50">01 02 03 04 05</textarea></p><p>Klartextlänge in Byte (Standard 128 Mebibyte). <span style="color:grey">Intern wird jedes Byte als uint32 verarbeitet. Der Klartext benötigt also viermal so viel Speicher (512 Mebibyte) wie der Wert den man eingibt.</span></br> <input type="number" id="plaintext_length_input" value="134217728" min="0"></p><div style="color: gray; " id="PlainHexRepresentation"></div><span style="color:red">Die Seite blockiert nach dem Aufruf der Verschlüsselung. Mit den Standardwerten sind Wartezeiten von bis zu 15 Sekunden normal. </span> <br /><input type="button" style="background-color:lightgreen" id="btn_encrypt" value="Ver-/Entschlüsseln" onclick="doIt()"> <span style="color:grey"> Für vergleichbare Ergebnisse nach jedem Ver-/Entschlüsseln die Seite neu laden. Ansonsten wird Speicher wiederverwendet, was die Laufzeit künstlich beschleunigt. </span></form><h3>Ausgabe</h3><table border="1"><tr><th>Ausgeführte Aufgabe</th><th>Umgebung</th><th>benötigte Zeit</th></tr><tr><td>Schlüssel einlesen und konvertieren</td><td>JavaScript</td><td id="time12" style="background-color:yellow"></div></td></tr><tr><td>Zufälligen Klartext erzeugen</td><td>JavaScript</td><td id="time23" style="background-color:yellow"></td></tr><tr><td>Text verschlüsseln</td><td>Clang-LLVM-WebAssembly</td><td id="time34" style="background-color:yellow"></td></tr><tr><td>Ergebnis in GUI ausgeben</td><td>JavaScript</td><td id="time45" style="background-color:yellow"></td></tr></table><p>Die ersten Bytes des Geheimtextes:</p><div id="output" style="background-color:yellow"></div><p style="color:grey">Der komplette Geheimtext wird bewusst nicht ausgegeben, da er die Seite zu lange blockieren lässt.</p>
	</body>
</html>
